# Security Configuration Template
# This file contains comprehensive security settings for {{.Name}}
# Environment-specific overrides should be applied in respective config files

security:
  # Content Security Policy Configuration
  content_security_policy:
    enabled: true
    # Restrictive CSP for production environments
    default_src: "'self'"
    script_src: "'self' 'nonce-RANDOM_CSP_NONCE_VALUE'"
    style_src: "'self' 'unsafe-inline'"
    img_src: "'self' data: https:"
    font_src: "'self' https:"
    connect_src: "'self' https:"
    frame_ancestors: "'none'"
    base_uri: "'self'"
    form_action: "'self'"
    upgrade_insecure_requests: true
    # Report violations to security endpoint
    report_uri: "/api/v1/security/csp-report"
    report_to: "csp-endpoint"

  # HTTP Security Headers
  security_headers:
    enabled: true
    headers:
      # Prevent MIME type sniffing
      x_content_type_options: "nosniff"
      # Prevent clickjacking attacks
      x_frame_options: "DENY"
      # Enable XSS protection
      x_xss_protection: "1; mode=block"
      # Control referrer information
      referrer_policy: "strict-origin-when-cross-origin"
      # Restrict permissions for browser features
      permissions_policy: "camera=(), microphone=(), geolocation=(), payment=(), usb=(), magnetometer=(), gyroscope=(), accelerometer=(), fullscreen=(self), display-capture=()"
      # Force HTTPS connections
      strict_transport_security: "max-age=31536000; includeSubDomains; preload"
      # Cross-origin policies
      cross_origin_embedder_policy: "require-corp"
      cross_origin_opener_policy: "same-origin"
      cross_origin_resource_policy: "same-origin"

  # Session Security Configuration
  session:
    # Session cookie settings
    cookie_name: "{{.Name}}_session"
    cookie_secure: true # Only send over HTTPS
    cookie_http_only: true # Prevent XSS access to cookies
    cookie_same_site: "Strict" # CSRF protection
    cookie_max_age: 1800 # 30 minutes
    # Session security
    session_timeout: 1800 # 30 minutes of inactivity
    absolute_timeout: 28800 # 8 hours maximum session duration
    regenerate_on_login: true # Prevent session fixation
    regenerate_interval: 900 # Regenerate session ID every 15 minutes
    # Session storage encryption
    encryption_key: "${SESSION_ENCRYPTION_KEY}" # 32-byte key for AES-256
    signing_key: "${SESSION_SIGNING_KEY}" # HMAC signing key

  # Authentication Security
  authentication:
    # Password requirements
    password_policy:
      min_length: 12
      require_uppercase: true
      require_lowercase: true
      require_numbers: true
      require_special_chars: true
      forbidden_patterns:
        - "password"
        - "123456"
        - "qwerty"
        - "{{.Name}}"
      max_age_days: 90 # Force password change every 90 days
    
    # Account lockout protection
    lockout_policy:
      max_attempts: 3
      lockout_duration: 1800 # 30 minutes
      progressive_delay: true # Increase delay with each failed attempt
      
    # JWT Security
    jwt:
      algorithm: "HS256" # Never allow 'none' algorithm
      access_token_expiry: 900 # 15 minutes
      refresh_token_expiry: 604800 # 7 days
      issuer: "{{.Name}}-api"
      audience: "{{.Name}}-client"
      # Token rotation for comprehensive security
      refresh_token_rotation: true
      # Blacklist compromised tokens
      token_blacklist_enabled: true

  # Rate Limiting Configuration
  rate_limiting:
    enabled: true
    # Global rate limits
    global:
      requests_per_minute: 60
      burst: 10
    # Endpoint-specific limits
    endpoints:
      "/api/v1/auth/login":
        requests_per_minute: 5
        burst: 2
      "/api/v1/auth/register":
        requests_per_minute: 3
        burst: 1
      "/api/v1/auth/password-reset":
        requests_per_minute: 2
        burst: 1
    # IP-based blocking
    ip_whitelist: []
    ip_blacklist: []
    auto_ban_threshold: 100 # requests per minute to trigger auto-ban
    auto_ban_duration: 3600 # 1 hour

  # Input Validation and Sanitization
  input_validation:
    # Maximum request sizes
    max_request_size: "10MB"
    max_json_size: "1MB"
    max_form_size: "5MB"
    max_multipart_size: "50MB"
    
    # Content type validation
    allowed_content_types:
      - "application/json"
      - "application/x-www-form-urlencoded"
      - "multipart/form-data"
      - "text/plain"
    
    # File upload security
    file_uploads:
      max_file_size: "10MB"
      allowed_extensions:
        - ".jpg"
        - ".jpeg"
        - ".png"
        - ".gif"
        - ".pdf"
        - ".txt"
        - ".csv"
      scan_for_malware: true
      quarantine_suspicious: true

  # Database Security
  database:
    # Connection security
    ssl_mode: "require"
    ssl_cert_verification: true
    connection_encryption: true
    
    # Query security
    prepared_statements_only: true
    query_timeout: 30 # seconds
    max_connections: 100
    
    # Data protection
    encrypt_sensitive_fields: true
    audit_queries: true
    log_slow_queries: true
    slow_query_threshold: 1000 # milliseconds

  # Logging Security Configuration
  logging:
    # Security event logging
    security_events:
      enabled: true
      log_level: "info"
      # Events to log
      events:
        - "authentication_success"
        - "authentication_failure"
        - "authorization_failure"
        - "password_change"
        - "account_lockout"
        - "suspicious_activity"
        - "rate_limit_exceeded"
        - "csp_violation"
        - "security_header_violation"
    
    # Data sanitization for logs
    sanitization:
      enabled: true
      # Fields to redact in logs
      redacted_fields:
        - "password"
        - "token"
        - "secret"
        - "key"
        - "authorization"
        - "cookie"
        - "session"
        - "credit_card"
        - "ssn"
        - "email" # Partially redact: user@domain.com -> u***@d***.com
        - "phone"
        - "ip_address" # Partially redact: 192.168.1.1 -> 192.168.*.* 
      
      # Replacement patterns
      replacement_char: "*"
      partial_redaction: true
      preserve_structure: true
    
    # Log retention and security
    retention:
      security_logs_days: 365 # Keep security logs for 1 year
      application_logs_days: 90
      debug_logs_days: 7
      
    # Log integrity
    log_signing: true
    log_encryption: true
    tamper_detection: true

  # API Security
  api:
    # API versioning security
    version_enforcement: true
    deprecated_version_warning: true
    
    # Request/Response security
    request_id_header: "X-Request-ID"
    correlation_id_header: "X-Correlation-ID"
    
    # API documentation security
    swagger_ui_enabled: false # Disable in production
    api_docs_auth_required: true
    
    # Response security
    remove_server_header: true
    remove_x_powered_by: true
    custom_error_pages: true
    
  # Monitoring and Alerting
  monitoring:
    # Security monitoring
    security_monitoring:
      enabled: true
      alert_thresholds:
        failed_logins_per_minute: 10
        rate_limit_violations_per_minute: 50
        csp_violations_per_minute: 5
        suspicious_requests_per_minute: 20
      
      # Alert destinations
      alert_webhook: "${SECURITY_ALERT_WEBHOOK}"
      alert_email: "${SECURITY_ALERT_EMAIL}"
      
    # Health checks with security context
    health_checks:
      include_security_status: true
      check_certificate_expiry: true
      check_dependency_vulnerabilities: true

  # Compliance and Audit
  compliance:
    # Audit trail
    audit_trail:
      enabled: true
      include_request_body: false # Don't log sensitive data
      include_response_body: false
      include_headers: true
      retention_days: 365
      
    # Privacy controls
    privacy:
      data_minimization: true
      purpose_limitation: true
      consent_tracking: true
      right_to_erasure: true
      
    # Regulatory compliance flags
    gdpr_compliance: true
    hipaa_compliance: false
    pci_compliance: false
    sox_compliance: false