{
  "repository": "{{.Organization}}/{{.Name}}",
  "branches": {
    "main": {
      "protection": {
        "required_status_checks": {
          "strict": true,
          "contexts": [
            "ci/frontend-tests",
            "ci/backend-tests",
            {{if or .Components.Mobile.Android .Components.Mobile.IOS}}"ci/mobile-tests",{{end}}
            "security/codeql-analysis",
            "security/trivy-scan",
            "security/dependency-audit",
            "security/secrets-scan",
            "license-compliance"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 2,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": true,
          "require_last_push_approval": true,
          "bypass_pull_request_allowances": {
            "users": [],
            "teams": ["{{.Organization}}/maintainers"],
            "apps": ["dependabot"]
          }
        },
        "restrictions": {
          "users": [],
          "teams": ["{{.Organization}}/maintainers", "{{.Organization}}/admins"],
          "apps": []
        },
        "required_linear_history": true,
        "allow_force_pushes": false,
        "allow_deletions": false,
        "block_creations": false,
        "required_conversation_resolution": true,
        "lock_branch": false,
        "allow_fork_syncing": true
      }
    },
    "develop": {
      "protection": {
        "required_status_checks": {
          "strict": true,
          "contexts": [
            "ci/frontend-tests",
            "ci/backend-tests",
            {{if or .Components.Mobile.Android .Components.Mobile.IOS}}"ci/mobile-tests",{{end}}
            "security/codeql-analysis",
            "security/trivy-scan"
          ]
        },
        "enforce_admins": false,
        "required_pull_request_reviews": {
          "required_approving_review_count": 1,
          "dismiss_stale_reviews": true,
          "require_code_owner_reviews": true,
          "require_last_push_approval": false,
          "bypass_pull_request_allowances": {
            "users": [],
            "teams": ["{{.Organization}}/maintainers"],
            "apps": ["dependabot"]
          }
        },
        "restrictions": null,
        "required_linear_history": false,
        "allow_force_pushes": false,
        "allow_deletions": false,
        "block_creations": false,
        "required_conversation_resolution": true,
        "lock_branch": false,
        "allow_fork_syncing": true
      }
    }
  },
  "rulesets": [
    {
      "name": "Security Requirements",
      "target": "branch",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "include": ["refs/heads/main", "refs/heads/develop"],
          "exclude": []
        }
      },
      "rules": [
        {
          "type": "required_status_checks",
          "parameters": {
            "required_status_checks": [
              {
                "context": "security/codeql-analysis",
                "integration_id": null
              },
              {
                "context": "security/trivy-scan",
                "integration_id": null
              },
              {
                "context": "security/dependency-audit",
                "integration_id": null
              }
            ],
            "strict_required_status_checks_policy": true
          }
        },
        {
          "type": "pull_request",
          "parameters": {
            "required_approving_review_count": 1,
            "dismiss_stale_reviews_on_push": true,
            "require_code_owner_review": true,
            "require_last_push_approval": false,
            "required_review_thread_resolution": true
          }
        }
      ],
      "bypass_actors": [
        {
          "actor_id": "{{.Organization}}/security-team",
          "actor_type": "Team",
          "bypass_mode": "always"
        }
      ]
    },
    {
      "name": "Commit Signing",
      "target": "branch",
      "enforcement": "active",
      "conditions": {
        "ref_name": {
          "include": ["refs/heads/main"],
          "exclude": []
        }
      },
      "rules": [
        {
          "type": "required_signatures",
          "parameters": {}
        }
      ],
      "bypass_actors": []
    }
  ],
  "environments": {
    "production": {
      "protection_rules": [
        {
          "type": "required_reviewers",
          "reviewers": [
            {
              "type": "Team",
              "id": "{{.Organization}}/maintainers"
            }
          ]
        },
        {
          "type": "wait_timer",
          "wait_timer": 5
        }
      ],
      "deployment_branch_policy": {
        "protected_branches": true,
        "custom_branch_policies": false
      }
    },
    "staging": {
      "protection_rules": [
        {
          "type": "required_reviewers",
          "reviewers": [
            {
              "type": "Team", 
              "id": "{{.Organization}}/developers"
            }
          ]
        }
      ],
      "deployment_branch_policy": {
        "protected_branches": false,
        "custom_branch_policies": true,
        "custom_branches": ["develop", "main"]
      }
    }
  }
}